---
title: 堆栈的基本概念及用尾递归解决栈溢出问题
date: 2020/04/13 20:42:21
categories: js
tags: js
top: 2
---
### 堆栈的基本概念及用尾递归解决栈溢出问题

#### 基本概念
Heap(堆):用户主动请求而划分出来的内存区域(树形存储结构)  
+ 特点:从低位地址向高位地址增长,不会自动消失,必须手动释放,或者由垃圾回收机制来回收  

Stack(栈):由于函数运行而临时占用的内存区域(线形存储结构)
+ 特点:由内存区域的结束地址开始，从高位（地址）向低位（地址）分配  

#### 栈溢出问题
如下的js代码存在栈溢出的问题：
```js
// 栈溢出问题
function factorial(n) {
  if (n === 1) {
    return 1;
  }
  return n * factorial(n - 1);
}
console.log(factorial(50000));
```
主要原因是前一个函数的执行环境存在栈里面，没有及时得到回收，比如上一个函数的n是要和下一个函数的结果做运算的，gc不会回收  

解决方法有很多种，但思路都差不多，就是让栈里面始终保持当前的执行环境,这里提供一个尾函数调用的解决方案，在阶乘和斐波拉契数列中是基本思路了：
```js
function factorial(n, total) {
  if (n === 1) return total;
  return factorial(n - 1, n * total);
}
factorial(50000, 1);
```
> 这里也还可以对初始值赋默认值，或者通过curry化的方式去灵活调用
